#include <stdio.h>
#include "guava.h"

typedef struct {
	long     in;
	int      cap;
	unsigned ret;
} _test;

_test tests[] = {
	{10,5,2},
	{-19,5,0},
	{0xffffff,50,23},
	{1, 1, 0},
	{1, 2, 0},
	{1, 4, 0},
	{1, 8, 6},
	{1, 50, 45},
	{1, 100, 55},
	{1, 1000, 549},
	{1, 1024, 549},
	{1, 1025, 549},
	{2, 1, 0},
	{2, 2, 0},
	{2, 4, 3},
	{2, 8, 6},
	{2, 50, 46},
	{2, 100, 62},
	{2, 1000, 338},
	{2, 1024, 338},
	{2, 1025, 338},
	{3, 1, 0},
	{3, 2, 0},
	{3, 4, 3},
	{3, 8, 3},
	{3, 50, 8},
	{3, 100, 8},
	{3, 1000, 961},
	{3, 1024, 961},
	{3, 1025, 961},
	{34, 1, 0},
	{34, 2, 0},
	{34, 4, 3},
	{34, 8, 6},
	{34, 50, 31},
	{34, 100, 31},
	{34, 1000, 778},
	{34, 1024, 778},
	{34, 1025, 778},
	{-19, 1, 0},
	{-19, 2, 0},
	{-19, 4, 0},
	{-19, 8, 0},
	{-19, 50, 19},
	{-19, 100, 55},
	{-19, 1000, 790},
	{-19, 1024, 790},
	{-19, 1025, 790},
	{-199999999, 1, 0},
	{-199999999, 2, 0},
	{-199999999, 4, 2},
	{-199999999, 8, 4},
	{-199999999, 50, 13},
	{-199999999, 100, 62},
	{-199999999, 1000, 994},
	{-199999999, 1024, 994},
	{-199999999, 1025, 994},
	
};

int main () {
	int i,cnt = sizeof(tests)/sizeof(tests[0]);
	int ret;
	printf("%d..%d\n",cnt,cnt);
	for (i = 0; i< cnt; i++) {
		ret = guava( tests[i].in, tests[i].cap );
		if (ret != tests[i].ret) {
			printf("not ");
		}
		printf("ok %d - guava(%ld,%u)=%u\n", i+1, tests[i].in, tests[i].cap, tests[i].ret );
		if (ret != tests[i].ret) {
			printf("#\tFailed test 'guava(%ld,%u)=%u'\n",tests[i].in, tests[i].cap, tests[i].ret);
			printf("#\t     got: %u\n",ret);
			printf("#\texpected: %u\n",tests[i].ret);
		}
		
	}
	return 0;
}